<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>ç¦æ»¡æ˜Ÿæ²³ Â· æˆè¯­èŠ±ç«</title>
  <style>
    /* å®Œå…¨ä¿ç•™åŸç²’å­çƒŸèŠ±çš„æ ·å¼ï¼Œä»…å¢åŠ æ–‡å­—ç‰¹æ•ˆ */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
      touch-action: none;
      cursor: crosshair;
    }
    .panel {
      position: fixed;
      bottom: 20px;
      right: 24px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 12px;
      z-index: 30;
      pointer-events: none;
      font-family: 'Segoe UI', 'Arial', sans-serif;
    }
    .fireworks-tip {
      color: rgba(255, 245, 200, 0.9);
      font-size: 15px;
      letter-spacing: 2px;
      text-shadow: 0 0 8px #ff9f4b;
      backdrop-filter: blur(2px);
      padding: 8px 22px;
      border-radius: 50px;
      background: rgba(8, 5, 20, 0.5);
      border: 1px solid rgba(255, 200, 120, 0.4);
      pointer-events: none;
    }
    .music-control {
      pointer-events: auto;
      display: flex;
      align-items: center;
      gap: 12px;
      background: rgba(12, 8, 25, 0.7);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255, 190, 100, 0.5);
      border-radius: 60px;
      padding: 8px 22px;
      color: #ffe3b5;
      font-size: 15px;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      transition: 0.2s;
      cursor: pointer;
      user-select: none;
    }
    .music-control:hover {
      background: rgba(30, 18, 45, 0.85);
      border-color: #ffb974;
      color: #fff3d6;
    }
    .music-icon {
      font-size: 22px;
      line-height: 1;
    }
    input.volume-slider {
      width: 72px;
      height: 4px;
      -webkit-appearance: none;
      background: rgba(255, 200, 120, 0.3);
      border-radius: 4px;
      outline: none;
    }
    input.volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #ffc085;
      border-radius: 50%;
      border: 1px solid #fffae5;
      box-shadow: 0 0 12px #ffa84d;
      cursor: pointer;
      transition: 0.08s;
    }
    input.volume-slider::-webkit-slider-thumb:hover {
      background: #ffdb9f;
      transform: scale(1.2);
    }
  </style>
</head>
<body>
  <canvas id="fireworksCanvas"></canvas>

  <div class="panel">
    <div class="fireworks-tip">
      âœ¦ æŒ‡å°–è½»ç‚¹ Â· ç¦å­—æˆåˆ— âœ¦
    </div>
    <div id="musicControl" class="music-control">
      <span class="music-icon">ğŸµ</span>
      <span id="musicStatus">ä¹èµ·æ˜Ÿæ²³</span>
      <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.01" value="0.45">
    </div>
  </div>

  <script>
    (function() {
      "use strict";

      // ---------- ç”»å¸ƒ ----------
      const canvas = document.getElementById('fireworksCanvas');
      let ctx = canvas.getContext('2d');
      let width = window.innerWidth;
      let height = window.innerHeight;

      // ---------- åŸç²’å­çƒŸèŠ±ç³»ç»Ÿï¼ˆå®Œå…¨ä¿ç•™ï¼‰----------
      let particles = [];
      let stars = [];

      // ç‰©ç†å‚æ•°
      const GRAVITY = 0.1;
      const FRICTION = 0.98;
      const MAX_PARTICLES = 1500;

      // ---------- æ–°å¢ï¼šç¥ç¦æ–‡å­—ç³»ç»Ÿ ----------
      let blessingTexts = [];   // å­˜å‚¨å±å¹•ä¸Šæ­£åœ¨æ˜¾ç¤ºçš„ç¥ç¦æ–‡å­—ï¼ˆæ¯ä¸ªå­—ç‹¬ç«‹ï¼‰
      
      // ç¥ç¦è¯åº“ï¼ˆæ‚¨å¯è‡ªç”±å¢åˆ ï¼‰
      const BLESSINGS = [
        "å²å²å¹³å®‰","å‰æ˜Ÿé«˜ç…§","äº”ç¦ä¸´é—¨","å››å­£å®‰åº·","å–œä¹æ— å¿§",
"ä¸‡äº‹é¡ºé‚","ç¦æš–å››å­£","å¹³å®‰å–œä¹","é˜–å®¶å¹¸ç¦","ç¦å¯¿å®‰åº·",
"é¡ºé£é¡ºæ°´","ç‘æ°”ç›ˆé—¨","å–œä¹é•¿å®‰","ä¸‡äº‹äº¨é€š","å‰ç¥¥å¦‚æ„",
"å‰ç¨‹ä¼¼é”¦","å®å›¾å¤§å±•","æ‰æ€æ³‰æ¶Œ","ä¸‹ç¬”æœ‰ç¥","é€¢è€ƒå¿…è¿‡",
"é‡‘æ¦œé¢˜å","å­¦ä¸šæœ‰æˆ","æ­¥æ­¥é«˜å‡","åŠŸä¸å”æ","åšç§¯è–„å‘",
"ä¹˜é£ç ´æµª","æ¸¸åˆƒæœ‰ä½™","æŠ€è¿›ä¹é“","ç ”ç²¾æ¯•æ™º","ç‹¬å é³Œå¤´",
"è´¢æºå¹¿è¿›","å¯Œè´µå®‰åº·","æ˜¥é£å¾—æ„","èŠ±å¥½æœˆåœ†","å²å²æœ‰ä½™",
"ä¸°è¡£è¶³é£Ÿ","é™¶ç„¶è‡ªä¹","ç´«æ°”ä¸œæ¥","å®‰å±…ä¹ä¸š","æ‹›è´¢è¿›å®",
"é©¬åˆ°æˆåŠŸ","ä¸€é©¬å½“å…ˆ","é¾™é©¬ç²¾ç¥","ç­–é©¬å¥”è…¾","éªä¸šæ—¥æ–°",
"é£é»„è…¾è¾¾","å€šé©¬åƒè¨€","é²œè¡£æ€’é©¬","å¤©é©¬è¡Œç©º","ä¸‡é©¬å¥”è…¾"
      ];

      // ---------- æ˜Ÿç©ºç”Ÿæˆ ----------
      function generateStars(count = 250) {
        stars = [];
        for (let i = 0; i < count; i++) {
          stars.push({
            x: Math.random() * width,
            y: Math.random() * height,
            radius: Math.random() * 2.0 + 1.0,
            brightness: Math.random() * 0.7 + 0.5,
            twinkle: Math.random() * 0.2 + 0.9,
          });
        }
      }

      // ---------- åŸçƒŸèŠ±çˆ†ç‚¸ï¼ˆç‚¹å‡»å’Œè‡ªåŠ¨éƒ½ä¼šè°ƒç”¨ï¼‰----------
      function createExplosion(centerX, centerY, customCount) {
        let baseCount = Math.floor(Math.random() * 50) + 80;
        if (particles.length > MAX_PARTICLES * 0.7) {
          baseCount = Math.floor(baseCount * 0.6);
        }
        const particleCount = customCount || baseCount;
        const baseHue = Math.random() * 360;
        
        for (let i = 0; i < particleCount; i++) {
          const angle = Math.random() * Math.PI * 2;
          const speed = Math.random() * 6.5 + 2.8;
          let vx = Math.cos(angle) * speed * (Math.random() * 0.7 + 0.7);
          let vy = Math.sin(angle) * speed * (Math.random() * 0.7 + 0.7);
          if (Math.random() > 0.8) {
            vx *= 1.6;
            vy *= 1.6;
          }
          const hue = (baseHue + (Math.random() * 40 - 20) + 360) % 360;
          const saturation = 85 + Math.random() * 15;
          const lightness = 60 + Math.random() * 25;
          const color = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
          const size = Math.random() * 2.0 + 1.5;
          const alpha = Math.random() * 0.4 + 0.65;
          const decay = Math.random() * 0.009 + 0.006;

          particles.push({
            x: centerX, y: centerY,
            vx, vy,
            size, color,
            alpha: alpha > 1 ? 1 : alpha,
            decay
          });
        }
      }

      // ---------- â˜… æ–°å¢ï¼šç”Ÿæˆæ’æˆä¸€åˆ—ã€å€¾æ–œçš„å››å­—ç¥ç¦è¯­ â˜… ----------
      function createBlessingLine(centerX, centerY) {
        // éšæœºé€‰ä¸€ä¸ªç¥ç¦æˆè¯­
        const blessing = BLESSINGS[Math.floor(Math.random() * BLESSINGS.length)];
        const chars = blessing.split('');  // å››ä¸ªæ±‰å­—
        
        // å€¾æ–œè§’åº¦ï¼ˆ-30åº¦ï½30åº¦ä¹‹é—´éšæœºï¼Œå¼§åº¦ï¼‰
        const tiltAngle = (Math.random() * 60 - 30) * Math.PI / 180;
        
        // å­—ä¸å­—ä¹‹é—´çš„é—´è·ï¼ˆåƒç´ ï¼‰ï¼Œæ ¹æ®å±å¹•å®½åº¦è‡ªé€‚åº”
        const charSpacing = Math.min(width, height) * 0.1;
        
        // æ•´ä½“åˆé€Ÿåº¦ï¼ˆå‘å¤–é£˜æ•£çš„é€Ÿåº¦ï¼‰
        const speedX = (Math.random() - 0.5) * 1.2;
        const speedY = (Math.random() - 0.8) * 1.2 - 0.5; // ç•¥å‘ä¸Š
        
        // æ¯ä¸ªå­—çš„é¢œè‰²ï¼šé‡‡ç”¨å–œåº†çš„é‡‘è‰²/çº¢è‰²/æ©™è‰²ç³»
        const baseHue = Math.random() * 60 + 30; // 30ï½90 æ©™é»„çº¢
        
        chars.forEach((char, index) => {
          // è®¡ç®—è¯¥å­—ç›¸å¯¹äºä¸­å¿ƒçš„ä½ç½®ï¼šæ²¿å€¾æ–œæ–¹å‘æ’åˆ—
          // è®©å››ä¸ªå­—å‡åŒ€åˆ†å¸ƒåœ¨ä¸€æ¡ç›´çº¿ä¸Šï¼Œä¸­å¿ƒç‚¹ä½äºç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå­—ä¹‹é—´
          const offsetIndex = index - 1.5; // -1.5, -0.5, 0.5, 1.5
          const offsetX = Math.cos(tiltAngle) * offsetIndex * charSpacing;
          const offsetY = Math.sin(tiltAngle) * offsetIndex * charSpacing;
          
          // æ¯ä¸ªå­—å¯ä»¥æœ‰å°å¹…åº¦éšæœºåç§»ï¼Œçœ‹èµ·æ¥æ›´è‡ªç„¶
          const randOffsetX = (Math.random() - 0.5) * 4;
          const randOffsetY = (Math.random() - 0.5) * 4;
          
          // é¢œè‰²ï¼šåŒä¸€ç»„æˆè¯­ä½¿ç”¨ç›¸è¿‘è‰²ï¼Œæ¯ä¸ªå­—å¾®è°ƒ
          const hue = baseHue + (Math.random() * 20 - 10);
          const sat = 85 + Math.random() * 15;
          const light = 55 + Math.random() * 30;
          const color = `hsl(${hue}, ${sat}%, ${light}%)`;
          
          // æ–‡å­—å¤§å°ï¼šä¹Ÿéšå±å¹•ç¼©æ”¾
          const fontSize = Math.min(width, height) * 0.06 + 8; // 28ï½40px
          
          blessingTexts.push({
            char: char,
            x: centerX + offsetX + randOffsetX,
            y: centerY + offsetY + randOffsetY,
            vx: speedX + (Math.random() - 0.5) * 0.5,
            vy: speedY + (Math.random() - 0.5) * 0.5,
            size: fontSize,
            color: color,
            alpha: 0.95,          // åˆå§‹è¾ƒäº®
            decay: 0.005 + Math.random() * 0.004, // é€æ¸æ·¡å‡º
            rotation: tiltAngle + (Math.random() - 0.5) * 0.1, // æ•´ä½“å€¾æ–œåŠ å¾®å°æ‰°åŠ¨
            rotSpeed: (Math.random() - 0.5) * 0.01
          });
        });
      }

      // ---------- è‡ªé€‚åº” ----------
      function resizeCanvas() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        generateStars(260);
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, width, height);
      }

      // ---------- æ›´æ–°ç²’å­ï¼ˆçƒŸèŠ±ç²’å­+ç¥ç¦æ–‡å­—ï¼‰----------
      function updateParticles() {
        // 1. æ›´æ–°æ™®é€šçƒŸèŠ±ç²’å­
        for (let p of particles) {
          p.x += p.vx;
          p.y += p.vy;
          p.vy += GRAVITY;
          p.vx *= FRICTION;
          p.vy *= FRICTION;
          p.alpha -= p.decay;
        }
        particles = particles.filter(p => 
          p.alpha > 0.08 && 
          p.x > -width * 0.3 && p.x < width * 1.3 &&
          p.y > -height * 0.3 && p.y < height * 1.3
        );
        if (particles.length > MAX_PARTICLES) {
          particles = particles.slice(-MAX_PARTICLES);
        }

        // 2. æ›´æ–°ç¥ç¦æ–‡å­—
        for (let t of blessingTexts) {
          t.x += t.vx;
          t.y += t.vy;
          // æ–‡å­—è½»å¾®ç‰©ç†ï¼ˆé‡åŠ›å¾ˆå¼±ï¼‰
          t.vy += GRAVITY * 0.3;
          t.vx *= FRICTION;
          t.vy *= FRICTION;
          t.alpha -= t.decay;
          if (t.rotSpeed) t.rotation += t.rotSpeed;
        }
        blessingTexts = blessingTexts.filter(t => 
          t.alpha > 0.1 && 
          t.x > -width * 0.2 && t.x < width * 1.2 &&
          t.y > -height * 0.2 && t.y < height * 1.2
        );
      }

      // ---------- ç»˜åˆ¶ï¼ˆåŸçƒŸèŠ±ç²’å­ + ç¥ç¦æ–‡å­—ï¼‰----------
      function draw() {
        // æ‹–å°¾
        ctx.fillStyle = 'rgba(0, 0, 0, 0.14)';
        ctx.fillRect(0, 0, width, height);

        // æ˜Ÿæ˜Ÿ
        for (let s of stars) {
          const twinkle = 0.9 + Math.sin(Date.now() * 0.002 + s.x * 0.01) * 0.15;
          const alpha = Math.min(s.brightness * twinkle, 0.95);
          ctx.fillStyle = `rgba(255, 250, 235, ${alpha})`;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
          ctx.fill();
        }

        // ---- ç»˜åˆ¶åŸçƒŸèŠ±ç²’å­ï¼ˆå¸¦å…‰æ™•ï¼‰----
        ctx.shadowColor = 'rgba(255, 200, 150, 0.5)';
        ctx.shadowBlur = 3.5;
        for (let p of particles) {
          ctx.globalAlpha = p.alpha;
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
          // é«˜å…‰
          ctx.globalAlpha = p.alpha * 0.3;
          ctx.fillStyle = '#fffbe6';
          ctx.beginPath();
          ctx.arc(p.x - 0.5, p.y - 0.5, p.size * 0.25, 0, Math.PI * 2);
          ctx.fill();
        }

        // ---- ç»˜åˆ¶ç¥ç¦æ–‡å­—ï¼ˆç‹¬ç«‹å…‰æ™•ï¼Œæ›´äº®ï¼‰----
        ctx.shadowColor = 'rgba(255, 220, 100, 0.8)';
        ctx.shadowBlur = 10;
        ctx.font = `bold ${Math.min(width, height) * 0.06 + 8}px "Microsoft Yahei", "PingFang SC", "Noto Sans CJK", "Segoe UI", sans-serif`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        for (let t of blessingTexts) {
          ctx.globalAlpha = t.alpha;
          ctx.fillStyle = t.color;
          ctx.save();
          ctx.translate(t.x, t.y);
          ctx.rotate(t.rotation);
          ctx.font = `bold ${t.size}px "Microsoft Yahei", "PingFang SC", "Noto Sans CJK", "Segoe UI", sans-serif`;
          ctx.fillText(t.char, 0, 0);
          ctx.restore();
        }

        // é‡ç½®
        ctx.globalAlpha = 1.0;
        ctx.shadowBlur = 0;
        ctx.shadowColor = 'transparent';
      }

      // ---------- åŠ¨ç”»å¾ªç¯ ----------
      function animate() {
        updateParticles();

        // è‡ªåŠ¨çƒŸèŠ±ï¼ˆä¸åŸä»£ç ä¸€è‡´ï¼‰
        if (particles.length < MAX_PARTICLES * 0.8 && Math.random() < 0.032) {
          const randX = Math.random() * (width * 0.8) + width * 0.1;
          const randY = Math.random() * (height * 0.5) + height * 0.1;
          createExplosion(randX, randY, 100 + Math.floor(Math.random() * 40));
        }
        if (particles.length < MAX_PARTICLES * 0.7 && Math.random() < 0.015) {
          const rareX = Math.random() * (width * 0.7) + width * 0.2;
          const rareY = Math.random() * (height * 0.4) + height * 0.1;
          createExplosion(rareX, rareY, 120);
        }

        draw();
        requestAnimationFrame(animate);
      }

      // ---------- éŸ³ä¹ç³»ç»Ÿï¼ˆä½¿ç”¨æ‚¨éªŒè¯æœ‰æ•ˆçš„å¹´å¤œé¥­ï¼‰----------
      const MUSIC_URL = 'https://cdn.jsdelivr.net/gh/ganqirui3-sketch/happynewyear@main/nianyefan.mp3';
      
      const audio = new Audio();
      audio.src = MUSIC_URL;
      audio.loop = true;
      audio.preload = 'auto';
      audio.volume = 0.45;
      audio.muted = true;
      audio.load();

      let userActivated = false;

      function enableAudio() {
        if (userActivated) return;
        userActivated = true;
        audio.muted = false;
        audio.play()
          .then(() => document.getElementById('musicStatus').innerText = 'éŸ³æµªæµæ·Œ')
          .catch(() => {
            audio.play();
            document.getElementById('musicStatus').innerText = 'å¾…ç‚¹å‡»å”¤é†’';
          });
      }

      // ---------- äº¤äº’ï¼šç‚¹å‡»è§¦å‘ï¼ˆåŸçƒŸèŠ±ç²’å­ + ç¥ç¦æ–‡å­—ï¼‰----------
      function handleCanvasInteraction(e) {
        let clientX, clientY;
        if (e.touches) {
          e.preventDefault();
          clientX = e.touches[0].clientX;
          clientY = e.touches[0].clientY;
        } else {
          clientX = e.clientX;
          clientY = e.clientY;
        }

        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const canvasX = (clientX - rect.left) * scaleX;
        const canvasY = (clientY - rect.top) * scaleY;
        const safeX = Math.min(Math.max(canvasX, 20), width - 20);
        const safeY = Math.min(Math.max(canvasY, 20), height - 20);

        // 1. ç”ŸæˆåŸç²’å­çƒŸèŠ±ï¼ˆå®Œå…¨ä¿ç•™ï¼‰
        createExplosion(safeX, safeY, 130 + Math.floor(Math.random() * 50));
        
        // 2. ç”Ÿæˆç¥ç¦æ–‡å­—â€”â€”æ’æˆä¸€åˆ—ã€å€¾æ–œçš„å››å­—æˆè¯­
        createBlessingLine(safeX, safeY);
        
        // 3. å”¤é†’éŸ³ä¹
        enableAudio();
      }

      // ---------- éŸ³é‡æ§åˆ¶ã€éŸ³ä¹æŒ‰é’® ----------
      function initVolumeControl() {
        const slider = document.getElementById('volumeSlider');
        slider.addEventListener('input', function() {
          audio.volume = parseFloat(this.value);
          if (audio.muted && audio.volume > 0) {
            audio.muted = false;
            audio.play().catch(() => {});
          }
        });
      }

      function initMusicControl() {
        const control = document.getElementById('musicControl');
        const statusEl = document.getElementById('musicStatus');
        control.addEventListener('click', function(e) {
          if (e.target.classList.contains('volume-slider')) return;
          if (audio.muted) {
            audio.muted = false;
            audio.play()
              .then(() => statusEl.innerText = 'éŸ³æµªæµæ·Œ')
              .catch(() => {});
          } else {
            audio.muted = true;
            statusEl.innerText = 'é™éŸ³';
          }
        });
      }

      // ---------- åˆå§‹åŒ– ----------
      function init() {
        resizeCanvas();

        // å¼€åœºå››æœµæ™®é€šçƒŸèŠ± + å››ç»„ç¥ç¦æ–‡å­—
        setTimeout(() => {
          if (width > 200 && height > 200) {
            createExplosion(width * 0.3, height * 0.25, 120);
            createBlessingLine(width * 0.3, height * 0.25);
            
            createExplosion(width * 0.7, height * 0.35, 120);
            createBlessingLine(width * 0.7, height * 0.35);
            
            createExplosion(width * 0.5, height * 0.2, 140);
            createBlessingLine(width * 0.5, height * 0.2);
            
            createExplosion(width * 0.2, height * 0.4, 110);
            createBlessingLine(width * 0.2, height * 0.4);
          }
        }, 100);

        canvas.addEventListener('click', handleCanvasInteraction);
        canvas.addEventListener('touchstart', handleCanvasInteraction, { passive: false });
        window.addEventListener('resize', resizeCanvas);

        initVolumeControl();
        initMusicControl();

        audio.play().catch(() => {
          audio.muted = true;
          audio.play().catch(() => {});
        });

        animate();
      }

      init();
    })();
  </script>
</body>
</html>